
<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="kleiner webradio">
        <meta name="author" content="Web @ 2.21">

        <link rel="shortcut icon" type="image/png" href="/favicon.png">

        <title>Webradio</title>


        <link href="/css/bootstrap.min.css" rel="stylesheet">
        <link href="/css/4-col-portfolio.css" rel="stylesheet">
        <!-- link href="/css/font-awesome.min.css" rel="stylesheet" -->


        <!--        <script>
                    function sendRequest(request, data = ""){
                        $.ajax({
                            url: "ajax.php",
                            type: "post",
                            data: {"q": request, "data": data},
                            success: function (response) {
                                //console.log(response);
                                //updateTitle();
                                setCurrentActive();
                            }, error: function (jqXHR, textStatus, errorThrown) {
                                console.log(textStatus, errorThrown);
                                //alert("Can't reach backend...");
                            }
                        });
                    }
        
                    /*
                     function getChannels() {sendRequest("getChannels");}
                     function getTitle() {sendRequest("getTitle");}
                     */
        
                    function setChannel(str) {
                        sendRequest("setChannel", str);
                    }
                    function vUp() {
                        sendRequest("vUp");
                    }
                    function vDown() {
                        sendRequest("vDown");
                    }
                    function mute() {
                        sendRequest("mute");
                    }
                    function pause() {
                        sendRequest("pause");
                    }
                </script>-->

    </head>

    <body>

        <!-- Navigation -->
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <!--button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                    </button -->
                    <a class="navbar-brand" >FH - Radio</a>
                </div>
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li>
                            <a href="#" onclick="$('body').addClass('body-dark')">Dark Theme</a>
                        </li>
                        <li>
                            <a href="#" onclick="$('body').removeClass()">Default Theme</a>
                        </li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container -->
        </nav>

        <!-- Page Content -->
        <div class="container">

            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">2.21 Webradio  <small id="currenttitle"></small></h1>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <h2 class="page-header">Volume Cöntröl
                        <!--<small>Secondary Text</small>-->
                    </h2>
                </div>
                <div class="col-lg-2 res-controls">

                    <div class="btn-group" role="group" aria-label="Volume Controls">
                        <button type="button" class="btn btn-default btn-lg" id="vup"><span class="glyphicon glyphicon-volume-up" aria-hidden="true"></span></button>
                        <button type="button" class="btn btn-default btn-lg" id="vdown"><span class="glyphicon glyphicon-volume-down" aria-hidden="true"></span></button>
                        <button type="button" class="btn btn-default btn-lg" onclick="javascript: mute()"><span class="glyphicon glyphicon-volume-off" aria-hidden="true"></span></button>
                    </div>

                </div>

                <div class="col-lg-8 text-center res-controls">
                    <div class="btn-group" role="group" aria-label="Playback Controls">
                        <button type="button" class="btn btn-default btn-lg" onclick="javascript: pause()"><span class="glyphicon glyphicon-play" aria-hidden="true"></span> Play/Stop</button>
                        <button type="button" class="btn btn-default btn-lg" onclick="javascript: prevChannel()"><span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span> Previous Channel</button>
                        <button type="button" class="btn btn-default btn-lg" onclick="javascript: nextChannel()"><span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span> Next Channel</button>
                        <button type="button" class="btn btn-default btn-lg" onclick="javascript: rndChannel()"><span class="glyphicon glyphicon-random" aria-hidden="true"></span> Random Channel</button>
                    </div>
                </div>

                <div class="col-lg-2 text-right res-controls">
                    <div class="btn-group" role="group" aria-label="General Controls">
                        <button type="button" class="btn btn-default btn-lg" onclick="javascript: setCurrentActive()"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> Refresh State</button>
                    </div>

                </div>
            </div>

            <!-- Page Heading -->
            <div class="row">
                <div class="col-lg-12">
                    <h2 class="page-header">Switch Radio Statio</h2>
                </div>
            </div>
            <!-- /.row -->

            <!-- Projects Row -->
            <div id="stationlist" class="row">

            </div>

            <hr>
            <!-- Footer -->
            <footer>
                <div class="row">
                    <div class="col-lg-12">
                        <p>Radio - Fadio</p>
                    </div>
                </div>
                <!-- /.row -->
            </footer>

        </div>
        <!-- /.container -->

        <!-- jQuery -->
        <script src="js/jquery.js"></script>

        <!-- Bootstrap Core JavaScript -->
        <script src="js/bootstrap.min.js"></script>


        <script>
            /*jquery extensions*/

            jQuery.fn.random = function () {
                var randomIndex = Math.floor(Math.random() * this.length);
                return jQuery(this[randomIndex]);
            };


            /* init ui*/
            
           
            $.get( "/getStationList", function( data ) {
                data = JSON.parse(data);
                for (var i = 0; i < data.length; i++) {
                   var current = data[i];
                   $( "#stationlist" ).append( 
                    '<div class="col-md-3 col-sm-6 portfolio-item-wrapper"><div class="portfolio-item" data-chid="' + current.id + '" ><div class="center-stuff"><img class="img-responsive" src="' +current.img + '" alt="' + current.desc + '"><p>' + current.desc + '</p></div></div></div>'       
                    );
               }
            });

            function updatePlayerState(data){
                data = JSON.parse(data);
                console.log("update player");
                $("#currenttitle").text(data.title);
                document.title = data.title + " - Webradio";
                
                //blocking request
                var random = Math.floor((Math.random() * 1000) + 1);
                $.get( "/update/blocking/" + random ,updatePlayerState);
            }

            $.get( "/update/instant",updatePlayerState);
            
            
            function sendCmd(cmd){
                $.get("/control/" + cmd);
            }
            
            
            function vDown(){
                sendCmd("voldown");
            }
            function vUp(){
                sendCmd("volup");
            }
            function setChannel(id){
                sendCmd("setStream?id=" + id);
            }
            function mute() {
                sendCmd("mute");
            }
            function pause() {
                sendCmd("pause");
            }

            var clock;
            $("#vdown")
                    .mouseup(function () {
                        clearInterval(clock);
                    })
                    .mousedown(function () {
                        vDown();
                        clock = setInterval(vDown, 200);
                    });

            $("#vup")
                    .mouseup(function () {
                        clearInterval(clock);
                    })
                    .mousedown(function () {
                        vUp();
                        clock = setInterval(vUp, 200);
                    });

            $(".portfolio-item").click(function () {
                setChannel($(this).data("chid"));
            });


//            function setCurrentActive() {
//                $.get("/currentStation", function (data) {
//                    $(".portfolio-item").removeClass("active");
//                    $(".portfolio-item[data-chid='" + data + "']").addClass("active");
//                });
//            }
//            setCurrentActive();

            function prevChannel() {
                var chid = $(".portfolio-item.active").parent().prev().find(".portfolio-item").data("chid");
                if (!chid) {
                    chid = $(".portfolio-item-wrapper:last-of-type .portfolio-item").data("chid");
                }
                setChannel(chid);
            }
            function nextChannel() {
                var chid = $(".portfolio-item.active").parent().next().find(".portfolio-item").data("chid");
                if (!chid) {
                    chid = $(".portfolio-item-wrapper:first-of-type .portfolio-item").data("chid");
                }
                setChannel(chid);
            }
            function rndChannel() {
                setChannel($(".portfolio-item:not(.active)").random().data("chid"));
            }


        </script>


    </body>

</html>

